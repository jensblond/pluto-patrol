<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Pluto Patrol</title>
        <script src="phaser.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var cursors;
        var tank;
        var ground;
        var shits;
        var anim;
        var total = 0;

        var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });

        function preload () {
            // Asset preloading
            game.load.spritesheet('tank', 'img/tank.png', 160, 76, 2);
            // game.load.image('ufo','img/ufo.png');
            // game.load.image('ufo2','img/ufo2.png');
            // game.load.image('ufo3','img/ufo3.png');
            // game.load.image('bullet', 'img/bullet.png');
            // game.load.image('pittfall', 'img/pittfall.png');
            // game.load.image('sky', 'img/sky.png');
            // game.load.image('mountain', 'img/mountain.png');
            game.load.image('shit', 'img/shit.png');
            game.load.image('ground', 'img/ground.png');
        }

        function render() {
            // game.debug.body(tank);
            game.debug.body(ground);
            game.debug.body(shits);
            game.debug.cameraInfo(game.camera, 32, 32);
        }

        function create () {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            game.world.setBounds(0, 0, 20000, game.height);
            // game.add.sprite(0, 0, 'ground');
            // grounds = game.add.group();
            // grounds.enableBody = true;

            ground = game.add.tileSprite(0, game.height - 64, game.stage.bounds.width, game.cache.getImage('ground').height, 'ground');
            ground.enableBody = true;
            // var  ground = grounds.create(0, game.height - 64, 'ground');
            // ground.body.immovable = true;
            
            tank = game.add.sprite(10, ground.y - (ground.height + 100), 'tank', 0);
            tank.animations.add('drive');
            

            game.physics.arcade.enable(tank);
            game.physics.arcade.enable(ground);

            ground.body.immovable = true;
            
            tank.body.bounce.y = 0.2;
            tank.body.gravity.y = 300;
            tank.body.collideWorldBounds = true;

            // Shit
            shits = game.add.group();
            game.physics.arcade.enable(shits);
            shits.enableBody = true;

            cursors = game.input.keyboard.createCursorKeys();
            add_shit();
        }

        function add_shit() {
            shit = game.add.sprite(500 , ground.y - game.cache.getImage('shit').height ,'shit');
            shits.add(shit);
            shit.body.immovable = true;
            next_shit = parseInt(Math.random() * 100) + 100;
        }

        function collision (tank_collide, shit_collide) {
            tank.kill();
        }

        function update() {
            tank.animations.play('drive',6);

            if (tank.alive) {
                game.camera.x += 1;
                ground.tilePosition.x -= 1;
                ground.x += 1;
            }
            
            game.physics.arcade.collide(tank, ground);
            game.physics.arcade.collide(tank, shits, collision);

            if ( tank.body.touching.down ) {
                tank.body.velocity.x = 1;    
            }
            
            if (cursors.left.isDown && tank.body.touching.down) {
                tank.body.velocity.x = -150;
                tank.animations.play('left');
            } else if (cursors.right.isDown && tank.body.touching.down) {
                tank.body.velocity.x = 150;
                tank.animations.play('right');
            } else {
                tank.animations.stop();
                tank.frame = 1;
            }
            
            //  Allow the tank to jump if they are touching the ground.
            if (cursors.up.isDown && tank.body.touching.down) {
                tank.body.velocity.y = -270;
            }
        }

    };

    </script>

    </body>
</html>